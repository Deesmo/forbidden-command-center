{% extends "base.html" %} {% block title %}AI Studio{% endblock %} {% block content %} <div class="page-header"> <h1>AI Studio</h1> <p class="subtitle">Generate brand images & videos for Forbidden Bourbon</p> </div> <!-- API KEY STATUS --> <div id="apiStatus" class="card" style="margin-bottom: 16px; padding: 12px 16px;"> <div style="display: flex; justify-content: space-between; align-items: center;"> <div style="display: flex; gap: 12px; align-items: center; font-size: 1rem;"> <span id="dalleStatus">â³ Checking...</span> <span id="runwayStatus">â³ Checking...</span> </div> <button id="keysBtn" class="btn btn-sm" onclick="document.getElementById('settingsPanel').classList.toggle('hidden')" style="font-size: 1.02rem; display: none;">âš™ Keys</button> </div> <div id="settingsPanel" class="hidden" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);"> <div class="form-group" style="margin-bottom: 8px;"> <label style="font-size: 1.05rem;">OpenAI API Key</label> <div style="display: flex; gap: 8px;"> <input type="password" id="openaiKey" class="form-control" placeholder="sk-..." style="font-size: 1rem;"> <button class="btn btn-primary btn-sm" onclick="saveKey('openai')">Save</button> </div> </div> <div class="form-group" style="margin-bottom: 4px;"> <label style="font-size: 1.05rem;">Runway ML API Key</label> <div style="display: flex; gap: 8px;"> <input type="password" id="runwayKey" class="form-control" placeholder="key_..." style="font-size: 1rem;"> <button class="btn btn-primary btn-sm" onclick="saveKey('runway')">Save</button> </div> </div> <p style="font-size: 1.05rem; color: var(--text-muted); margin-top: 8px;">Or set OPENAI_API_KEY / RUNWAY_API_KEY in Render env vars (recommended).</p> </div> </div> <!-- MODE TABS --> <div class="filter-tabs" style="margin-bottom: 16px;"> <button class="filter-tab active" onclick="switchMode('image', this)">ğŸ¨ Images</button> <button class="filter-tab" onclick="switchMode('video', this)">ğŸ¬ Video</button> <button class="filter-tab" onclick="switchMode('gallery', this)">ğŸ“ Gallery</button> </div> <!-- ==================== IMAGE MODE ==================== --> <div id="imageMode"> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Style Preset</h3> <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;"> <button class="style-preset active" data-style="product" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">ğŸ¥ƒ</span><span>Product</span> </button> <button class="style-preset" data-style="lifestyle" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">âœ¨</span><span>Lifestyle</span> </button> <button class="style-preset" data-style="artdeco" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">ğŸ›</span><span>Art Deco</span> </button> <button class="style-preset" data-style="cocktail" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">ğŸ¸</span><span>Cocktail</span> </button> <button class="style-preset" data-style="social" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">ğŸ“±</span><span>Social Ad</span> </button> <button class="style-preset" data-style="editorial" onclick="selectStyle(this)"> <span style="font-size: 1.2rem;">ğŸ“°</span><span>Editorial</span> </button> </div> </div> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Quick Scenes</h3> <div id="promptTemplates" style="display: flex; flex-wrap: wrap; gap: 6px;"></div> </div> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Describe the Scene</h3> <textarea id="imagePrompt" class="form-control" rows="4" placeholder="Describe the background scene (your real bottle will be placed on it)..."></textarea> <div style="display: flex; gap: 8px; margin-top: 12px;"> <select id="imageSize" class="form-control" style="flex: 1;"> <option value="1024x1024">Square 1:1</option> <option value="1792x1024">Landscape 16:9</option> <option value="1024x1792" selected>Portrait 9:16</option> </select> <select id="imageQuality" class="form-control" style="flex: 1;"> <option value="medium">Standard</option> <option value="high" selected>High</option> </select> </div> <div style="margin-top: 10px; padding: 12px; background: rgba(200,164,94,0.08); border-radius: 6px; border: 1px solid var(--border);"> <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"> <input type="checkbox" id="useBottleRef" checked style="width: 18px; height: 18px; accent-color: var(--gold);"> <span style="font-size: 0.95rem; color: var(--gold); font-weight: 600;">ğŸ“¸ Composite Mode â€” Real Bottle (Recommended)</span> </label> <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 4px;">AI generates ONLY the background scene, then your REAL bottle photo is composited on top. This guarantees your exact bottle â€” correct label, proof, shape, everything.</p> <div id="compositeControls" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"> <div style="flex: 1; min-width: 120px;"> <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px; display: block;">Bottle</label> <select id="bottleType" class="form-control" style="font-size: 0.9rem;"> <option value="small_batch" selected>Small Batch (Black Label)</option> <option value="single_barrel">Single Barrel (Gold Label)</option> </select> </div> <div style="flex: 1; min-width: 90px;"> <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px; display: block;">Position</label> <select id="bottlePosition" class="form-control" style="font-size: 0.9rem;"> <option value="center" selected>Center</option> <option value="left">Left</option> <option value="right">Right</option> </select> </div> <div style="flex: 1; min-width: 90px;"> <label style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px; display: block;">Bottle Size</label> <select id="bottleScale" class="form-control" style="font-size: 0.9rem;"> <option value="0.45">Small</option> <option value="0.55">Medium</option> <option value="0.65" selected>Large</option> <option value="0.78">Extra Large</option> </select> </div> </div> </div> <button id="generateImageBtn" class="btn btn-primary" style="width: 100%; margin-top: 12px;" onclick="generateImage()"> âœ¦ Generate Image </button> <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; text-align: center;"> Composite mode: AI builds the scene around your real bottle â€” natural lighting, shadows, and reflections. </p> </div> <div id="imageResult" class="card hidden" style="margin-bottom: 16px;"> <div id="imageLoading" class="hidden" style="text-align: center; padding: 40px;"> <div class="ai-spinner"></div> <p style="margin-top: 12px; color: var(--text-secondary); font-size: 1.05rem;">Generating your image...</p> <p style="color: var(--text-muted); font-size: 1.02rem;">This takes 10-20 seconds</p> </div> <div id="imageOutput" class="hidden"> <div id="imageError" class="hidden" style="text-align: center; padding: 20px; background: rgba(248,113,113,0.1); border-radius: var(--radius-md); margin-bottom: 8px;"> <p style="color: #f87171; font-size: 1rem; margin-bottom: 4px;">âš  Image failed to load</p> <p id="imageErrorDetail" style="color: var(--text-muted); font-size: 0.85rem;"></p> </div> <img id="generatedImage" src="" alt="Generated" style="width: 100%; border-radius: var(--radius-md);" onerror="document.getElementById('imageError').classList.remove('hidden'); document.getElementById('imageErrorDetail').textContent='URL: '+this.src.substring(0,80)+'...'; this.style.display='none';" onload="document.getElementById('imageError').classList.add('hidden'); this.style.display='';"> <div style="padding: 12px 0 0; display: flex; gap: 8px;"> <button class="btn btn-primary btn-sm" onclick="downloadImage()" style="flex: 1;">â¬‡ Save</button> <button id="favBtn" class="btn btn-sm" onclick="toggleFavorite()" style="flex: 1;">â­ Favorite</button> <button class="btn btn-sm" onclick="copyImageUrl()" style="flex: 1;">ğŸ“‹ Copy URL</button> <button class="btn btn-sm" onclick="regenerateImage()" style="flex: 1;">ğŸ”„ Redo</button> </div> </div> </div> </div> <!-- ==================== VIDEO MODE ==================== --> <div id="videoMode" class="hidden"> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Video Style</h3> <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;"> <button class="style-preset active" data-vstyle="pour" onclick="selectVideoStyle(this)"> <span style="font-size: 1.2rem;">ğŸ¥ƒ</span><span>Bourbon Pour</span> </button> <button class="style-preset" data-vstyle="glamour" onclick="selectVideoStyle(this)"> <span style="font-size: 1.2rem;">âœ¨</span><span>Bottle Glamour</span> </button> <button class="style-preset" data-vstyle="bar" onclick="selectVideoStyle(this)"> <span style="font-size: 1.2rem;">ğŸ¸</span><span>Bar Scene</span> </button> <button class="style-preset" data-vstyle="nature" onclick="selectVideoStyle(this)"> <span style="font-size: 1.2rem;">ğŸŒ¿</span><span>Kentucky</span> </button> </div> </div> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Quick Prompts</h3> <div id="videoPromptTemplates" style="display: flex; flex-wrap: wrap; gap: 6px;"></div> </div> <div class="card" style="margin-bottom: 16px;"> <h3 style="margin-bottom: 12px; font-size: 1.05rem; color: var(--gold);">Video Prompt</h3> <textarea id="videoPrompt" class="form-control" rows="4" placeholder="Describe the camera motion and action (e.g. 'camera slowly orbits the bottle, warm spotlight')..."></textarea> <div style="display: flex; gap: 8px; margin-top: 12px;"> <select id="videoDuration" class="form-control"> <option value="5">5 seconds</option> <option value="10" selected>10 seconds</option> </select> </div> <div style="margin-top: 10px; padding: 10px; background: rgba(200,164,94,0.08); border-radius: 6px; border: 1px solid var(--border);"> <label style="font-size: 0.95rem; color: var(--gold); display: block; margin-bottom: 6px;">ğŸ“¸ Source Image (uses real bottle photo as starting frame)</label> <select id="videoSourceImage" class="form-control" style="font-size: 0.95rem;"> <option value="">Text-only (no source image)</option> <option value="/static/photos/gallery/SmallBatch1.jpg" selected>Forbidden Small Batch â€” Hero Shot</option> <option value="/static/photos/gallery/Golden_Front_57_LightBG_V1.png">Forbidden Single Barrel â€” Gold</option> <option value="/static/photos/gallery/Black_Front_LightBG_V1.png">Forbidden Single Barrel â€” Black</option> {% for photo in ['xmas-whiskey-sour-1.jpg','xmas-whiskey-sour-2.jpg','xmas-whiskey-sour-3.jpg','xmas-whiskey-sour-4.jpg','xmas-whiskey-sour-5.jpg'] %} <option value="/static/photos/{{ photo }}">{{ photo | replace('-',' ') | replace('.jpg','') | title }}</option> {% endfor %} </select> <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 4px;">Runway uses this as the first frame â€” describe only the <strong>motion and camera</strong>, not the bottle (image already defines that).</p> </div> <button id="generateVideoBtn" class="btn btn-primary" style="width: 100%; margin-top: 12px;" onclick="generateVideo()"> ğŸ¬ Generate Video </button> </div> <div id="videoResult" class="card hidden" style="margin-bottom: 16px;"> <div id="videoLoading" class="hidden" style="text-align: center; padding: 40px;"> <div class="ai-spinner"></div> <p style="margin-top: 12px; color: var(--text-secondary); font-size: 1.05rem;">Generating video...</p> <p style="color: var(--text-muted); font-size: 1.02rem;">This can take 1-3 minutes</p> <p id="videoStatus" style="color: var(--gold-dark); font-size: 1.02rem; margin-top: 8px;"></p> </div> <div id="videoOutput" class="hidden"> <video id="generatedVideo" controls playsinline style="width: 100%; border-radius: var(--radius-md);"></video> <div style="padding: 12px 0 0; display: flex; gap: 8px;"> <button class="btn btn-primary btn-sm" onclick="downloadVideo()" style="flex: 1;">â¬‡ Save</button> <button class="btn btn-sm" onclick="regenerateVideo()" style="flex: 1;">ğŸ”„ Redo</button> </div> </div> </div> </div> <!-- ==================== GALLERY MODE ==================== --> <div id="galleryMode" class="hidden"> <div style="display: flex; gap: 8px; margin-bottom: 12px;"> <button id="galAllBtn" class="btn btn-primary btn-sm" onclick="loadGallery('all')" style="flex:1;">ğŸ“ All</button> <button id="galSavedBtn" class="btn btn-sm" onclick="loadGallery('saved')" style="flex:1;">â­ Favorites</button> </div> <div id="galleryGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px;"> <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);"> <p style="font-size: 1.05rem;">No generated content yet</p> <p style="font-size: 1.02rem; margin-top: 4px;">Generate images or videos to build your library</p> </div> </div> </div> <!-- VIDEO LIGHTBOX --> <div id="videoLightbox" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;align-items:center;justify-content:center;flex-direction:column;gap:12px;" onclick="closeVideoLightbox(event)"> <video id="lightboxVideo" controls playsinline style="max-width:92vw;max-height:80vh;border-radius:8px;box-shadow:0 4px 32px rgba(0,0,0,0.8);"></video> <button onclick="closeVideoLightbox()" style="background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.3);color:#fff;padding:8px 24px;border-radius:6px;cursor:pointer;font-size:0.95rem;">âœ• Close</button> </div> <style> .style-preset { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius-md); color: var(--text-secondary); font-size: 1.02rem; cursor: pointer; transition: all 0.2s; } .style-preset:hover { border-color: var(--gold-dark); } .style-preset.active { border-color: var(--gold); background: linear-gradient(135deg, rgba(200,164,94,0.1), var(--bg-card)); color: var(--gold); } .prompt-chip { padding: 6px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 20px; color: var(--text-secondary); font-size: 1.02rem; cursor: pointer; transition: all 0.2s; } .prompt-chip:hover { border-color: var(--gold-dark); color: var(--gold); } .ai-spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top: 3px solid var(--gold); border-radius: 50%; animation: aispin 1s linear infinite; margin: 0 auto; } @keyframes aispin { to { transform: rotate(360deg); } } </style> {% endblock %} {% block scripts %} <script src="/static/js/ai_studio.js?v=1772293277"></script> <!-- ===== CUTOUT CACHE CONTROL (injected by patch_aistudio.py) ===== --> <div id="cutoutCacheControl" style=" position: fixed; bottom: 18px; right: 18px; z-index: 9999; background: rgba(10,10,20,0.92); border: 1px solid #ff6b35; border-radius: 8px; padding: 10px 14px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 16px rgba(0,0,0,0.5); "> <button id="clearCutoutBtn" onclick="clearCutoutCache()" style="background:#ff6b35;border:none;color:#fff;padding:7px 14px; border-radius:5px;cursor:pointer;font-size:12px;font-weight:600; letter-spacing:0.5px;white-space:nowrap;"> Clear Cutout Cache </button> <span id="clearCutoutMsg" style="font-size:11px;color:#aaa;max-width:240px;"></span> </div> <script> function clearCutoutCache() { const btn = document.getElementById('clearCutoutBtn'); const msg = document.getElementById('clearCutoutMsg'); btn.disabled = true; btn.textContent = 'Clearing...'; msg.style.color = '#aaa'; msg.textContent = ''; fetch('/api/ai/clear-cutout-cache', { method: 'POST' }) .then(r => r.json()) .then(data => { if (data.success) { msg.style.color = '#4caf50'; msg.textContent = data.count > 0 ? 'Cleared ' + data.count + ' cutout(s). Next gen will re-extract via OpenAI API.' : 'Cache was already empty.'; } else { msg.style.color = '#f44336'; msg.textContent = 'Error: ' + data.error; } btn.textContent = 'Clear Cutout Cache'; btn.disabled = false; }) .catch(e => { msg.style.color = '#f44336'; msg.textContent = 'Request failed.'; btn.textContent = 'Clear Cutout Cache'; btn.disabled = false; }); } </script> <!-- ===== END CUTOUT CACHE CONTROL ===== --> {% endblock %}
